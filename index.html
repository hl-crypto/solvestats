<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>SolveStats | Final Fix</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: white; padding: 40px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .card { background: #1c2128; padding: 20px; border-radius: 10px; border: 1px solid #30363d; }
        .time { font-size: 2rem; font-weight: bold; color: #3498db; }
        .import-btn { background: #3498db; color: white; padding: 15px 30px; border-radius: 8px; cursor: pointer; border: none; font-weight: bold; }
    </style>
</head>
<body>

    <h1>SolveStats Analytics</h1>
    <label class="import-btn">LAST OPP CSTIMER FIL <input type="file" id="f" style="display:none"></label>
    <div id="status" style="margin: 20px 0; color: #2ecc71;"></div>

    <div class="grid" id="g"></div>

<script>
    const events = {"333":"3x3","222":"2x2","444":"4x4","555":"5x5","333oh":"3x3 OH","minx":"Megaminx","pyram":"Pyraminx","skewb":"Skewb"};
    
    // Lag boksene med en gang
    const g = document.getElementById('g');
    Object.keys(events).forEach(k => {
        g.innerHTML += `<div class="card"><h3>${events[k]}</h3><div class="time" id="${k}">--.--</div></div>`;
    });

    document.getElementById('f').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const data = JSON.parse(event.target.result);
            
            // Finn ut hvilken session som er hva
            let meta = {};
            if (data.properties && data.properties.sessionData) {
                meta = JSON.parse(data.properties.sessionData);
            }

            Object.keys(data).forEach(key => {
                if (key.startsWith('session')) {
                    const id = key.replace('session', '');
                    const type = (meta[id] && meta[id].opt) ? meta[id].opt.scrType : "333";
                    
                    // DENNE LINJEN ER FIKSEN: Vi henter tid fra s[0][1]
                    const times = data[key].map(s => s[0][1] / 1000).filter(t => t > 0);
                    
                    if (times.length > 0 && events[type]) {
                        const pb = Math.min(...times).toFixed(2);
                        document.getElementById(type).innerText = pb + "s";
                    }
                }
            });
            document.getElementById('status').innerText = "IMPORT VELLYKKET!";
        };
        reader.readAsText(e.target.files[0]);
    });
</script>
</body>
</html>
